"use strict";function updateUI(e){runners_paragraph.innerHTML=generateFormattedRunnerString(e.runner),game_link_a.href=e.link,game_link_a.onclick=function(){return window.open(this.href),!1},null!=e.category?game_link_a.innerHTML=e.game+" ("+e.category+")":game_link_a.innerHTML=e.game}function updateCalendarUI(e){if(console.log("Calendar updating..."),console.log(e),null!=e){$("#schedule-table tbody").empty();var t="";_.each(e.order,function(n,a){t+=generateScheduleItemString(e.schedule[n],e.highlights,a+1)}),$("#schedule-table tbody").html(t),console.log("Calendar updated.")}}function generateFormattedRunnerString(e){var t=_.keys(e),n="by ";if(t.length>2){var a=t.pop(),o=t.pop();$.each(t,function(t,a){n+=generateRunnerElement(e,a)+", "}),n+=generateRunnerElement(e,o)+" ",n+="and ",n+=generateRunnerElement(e,a)}else if(2==t.length){var a=t.pop(),o=t.pop();n+=generateRunnerElement(e,o),n+=" and ",n+=generateRunnerElement(e,a)}else if(1==t.length){t[0];n+=generateRunnerElement(e,t[0])}else console.log("Error no runners."),n="";return n}function generateRunnerElement(e,t){return null==e[t].logo?'<a href="'+e[t].link+'" onclick="window.open(this.href); return false;">'+t+"</a>":'<a href="'+e[t].link+'" onclick="window.open(this.href); return false;"><img class="runner-logo" src="'+e[t].logo+'" />'+t+"</a>"}function generateScheduleItemString(e,t,n){var a=generateFormattedRunnerString(e.runner);if(null!=e.category)var o=e.title+" ("+e.category+")";else var o=e.title;if(console.log(t),"undefined"==typeof t[e.title]||0==t[e.title])var i="";else{var i="background-color:#555555;";o='<i class="fa fa-star"></i> '+o}var s="<tr style="+i+' >\n                                <th scope="row">'+n+'</th>\n                                <td>\n                                    <a class="speedrun-link" id="next-game-title" href="'+e.link+'" onclick="window.open(this.href); return false;"> '+o+'</a>\n                                    <p class="runners-links" id="next-runners-information">'+a+'</p>\n                                </td>\n                                <td style="width: 114px;">\n                                    <p class="text-right"><i class="fa fa-clock-o" aria-hidden="true"></i> '+e.estimate+"</p>\n                                </td>\n                              </tr>";return s}function calculateRefreshRate(e){var t=6e4*e;return t}function updateRefreshRate(e){if("Set Refresh Timer:"==e)return console.log("No change in refresh timer value."),void $.notify({icon:"glyphicon glyphicon-warning-sign",title:"Refresh Timer Update:",message:"Please choose an option from the menu!"},{element:"body",position:null,type:"danger",allow_dismiss:!0,newest_on_top:!0,showProgressbar:!1,z_index:10001,placement:{from:"top",align:"right"}});if("number"==typeof parseInt(e)&&parseInt(e)>0){clearInterval(refreshTimer);var t=calculateRefreshRate(parseInt(e));setInterval(requestDataFromBackground,t),console.log("Refresh Timer has been updated to: "+e+" minutes or "+t+" milliseconds"),$.notify({icon:"glyphicon glyphicon-time",title:"Refresh Timer Update:",message:"Updated to refresh every "+e+" minutes"},{element:"body",position:null,type:"success",allow_dismiss:!0,newest_on_top:!0,showProgressbar:!1,z_index:10001,placement:{from:"top",align:"right"}})}}function sendUpdateCalendarItemsNumber(e){return"Set # of Runs to Display:"==e?(console.log("No change in numbers of runs to display in schedule."),void $.notify({icon:"glyphicon glyphicon-warning-sign",title:"Schedule Items Update",message:"Please choose an option from the menu!"},{element:"body",position:null,type:"danger",allow_dismiss:!0,newest_on_top:!0,showProgressbar:!1,z_index:10001,placement:{from:"top",align:"right"}})):void("number"==typeof parseInt(e)&&parseInt(e)>0&&(port.postMessage({message:"schedule",calendarItemsNumber:parseInt(e)}),$.notify({icon:"glyphicon glyphicon-time",title:"Schedule Items Update:",message:"Updated to display "+e+" runs."},{element:"body",position:null,type:"success",allow_dismiss:!0,newest_on_top:!0,showProgressbar:!1,z_index:10001,placement:{from:"top",align:"right"}})))}function requestDataFromBackground(){port.postMessage({message:"request"})}var refreshTimer=null,refreshRate=3e5,port=chrome.runtime.connect({name:"gdq"}),page_elem=document.querySelector("body");console.log(page_elem);var runners_paragraph=document.createElement("p"),game_link_a=document.createElement("a");runners_paragraph.id="gdq-runners-information",game_link_a.id="gdq-speedrun-link",game_link_a.className="speedrun-link";var footerHTML='<footer class="standard-footer" id="extension-footer">\n    <div class="extension-container">\n        <div class="game-information col-md-11"></div>\n        <div id="options">\n            <i class="fa fa-calendar collapsed" data-toggle="collapse" data-target="#collapseCalendar" aria-expanded="false"></i>\n            <i class="fa fa-refresh" id="settings-icon"></i>\n            <div class="btn-group dropup">\n                <a class="dropdown-toggle" id="settings-link" data-toggle="dropdown">\n                    <i class="fa fa-cog" id="settings-icon"></i>\n                </a>\n                <ul class="dropdown-menu settings-menu" style="left: -150px; margin-bottom: 20px;"></ul>\n            </div>\n        </div>\n        <div style="clear:both;"></div>\n        <div class="collapse col-md-11" id="collapseCalendar">\n            <!-- Schedule -->\n            <p><i class="fa fa-calendar" style="margin-right: 10px;"></i> Next Runs</p>\n            <table class="table" id="schedule-table">\n                <tbody>\n                </tbody>\n            </table>\n        </div>\n    </div>\n</footer>',settingsHTML='<li>\n    <div class="col-md-12">\n        <form class="form" role="form" method="post" action="" accept-charset="UTF-8" id="refresh-timer-update">\n            <div class="form-group">\n                <label for="timer"><i class="fa fa-clock-o" aria-hidden="true"></i> Refresh Timer</label>\n                <select class="form-control" id="refresh-timer-select" name="timer">\n                    <option selected="selected">Set Refresh Timer:</option>\n                    <option value="1">1 minute</option>\n                    <option value="2">2 minutes</option>\n                    <option value="3">3 minutes</option>\n                    <option value="4">4 minutes</option>\n                    <option value="5">5 minutes</option>\n                    <option value="6">6 minutes</option>\n                    <option value="7">7 minutes</option>\n                    <option value="8">8 minutes</option>\n                    <option value="9">9 minutes</option>\n                    <option value="10">10 minutes</option>\n                    <option value="15">15 minutes</option>\n                    <option value="20">20 minutes</option>\n                    <option value="25">25 minutes</option>\n                    <option value="30">30 minutes</option>\n                </select>\n                <button type="submit" class="btn btn-primary" id="refresh-timer-submit"><i class="fa fa-check" id="refresh-form-check" aria-hidden="true"></i></button>\n            </div>\n        </form>\n\n        <form class="form" role="form" method="post" action="" accept-charset="UTF-8" id="schedule-items-update">\n            <div class="form-group">\n                <label for="schedule-items"><i class="fa fa-calendar" aria-hidden="true"></i> Schedule Display</label>\n                <select class="form-control" id="schedule-items-select" name="schedule-items">\n                    <option selected="selected"># of Runs to Display:</option>\n                    <option value="1">1 run</option>\n                    <option value="2">2 runs</option>\n                    <option value="3">3 runs</option>\n                    <option value="4">4 runs</option>\n                    <option value="5">5 runs</option>\n                </select>\n                <button type="submit" class="btn btn-primary" id="schedule-items-submit"><i class="fa fa-check" id="schedule-items-check" aria-hidden="true"></i></button>\n            </div>\n        </form>\n        <div style="margin-bottom: 10px;">\n            <label for="quakenet-chat-switch" id="quakenet-chat-switch"><i class="fa fa-commenting-o" aria-hidden="true"></i> Quake Chat Embed</label>\n            <input type="checkbox" name="quakenet-chat-switch" />\n        </div>\n        <div style="margin-bottom: 10px;">\n            <label for="twitch-chat-switch" id="twitch-chat-switch"><i class="fa fa-twitch" aria-hidden="true"></i> Twitch Chat Embed</label>\n            <input type="checkbox" name="twitch-chat-switch"></input>\n        </div>\n        <div style="margin-bottom: 10px;">\n            <label for="theater-mode" id="theater-mode"><i class="fa fa-film" aria-hidden="true"></i> Quake Theater Mode</label>\n            <input type="checkbox" name="theater-mode" ></input>\n        </div>\n    </div>\n</li>',quakeChat='<div id="quakenet-chat" class="pull-left" style="width: 524px;\n    margin-top: 24px;\n    height: 436px;\n    margin-left: 10px;">\n  <iframe src="https://webchat.quakenet.org/?channels=sdamarathon" width="100%" height="100%" frameborder="0" scrolling="no" class="center-block"></iframe>\n</div>\n<div class="clearfix" id="quakenet-clear"></div>',quakeTheatherMode='<div id="theater-mode-div" style="width: 100%;height: 90%;position: fixed;background-color: #000;z-index: 10000;top: 0;left: 0;">\n    <div class="row" style="height: 100%;">\n        <div class="col-md-8" style="height: 100%; padding: 0px;">\n            <iframe src="https://player.twitch.tv/?channel=gamesdonequick" width="100%" height="100%" frameborder="0" scrolling="no" allowfullscreen="true" class="center-block"></iframe>\n        </div>\n        <div class="col-md-4" style="height: 100%; padding: 0px;">\n            <iframe src="https://webchat.quakenet.org/?channels=sdamarathon" width="100%" height="100%" frameborder="0" scrolling="no" class="center-block"></iframe>\n        </div>\n    </div>\n</div>',twitchChat='<div id="twitch-chat" class="pull-left" style="width: 524px;\n    margin-top: 24px;\n    height: 436px;\n    margin-left: 10px;">\n    <iframe frameborder="0" scrolling="no" id="chat_embed" src="https://www.twitch.tv/gamesdonequick/chat" height="436" width="524"></iframe>\n</div>\n<div class="clearfix" id="twitch-clear"></div>';$(page_elem).on("click","ul.dropdown-menu",function(e){e.stopPropagation()}),$(document).ready(function(){function e(e){if("add"==e){console.log("Switch is on. Adding Chat iframe and modifying UI."),$("#stream").removeClass("center-block").addClass("pull-left");var t=$("#stream");$(t).after(quakeChat)}else"remove"==e&&(console.log("Switch is off. Removing UI."),$("#stream").addClass("center-block").removeClass("pull-left"),$("#quakenet-chat").remove(),$("#quakenet-clear").remove())}function t(e){if("add"==e){console.log("Switch is on. Adding Chat iframe and modifying UI."),$("#stream").removeClass("center-block").addClass("pull-left");var t=$("#stream");$(t).after(twitchChat)}else"remove"==e&&(console.log("Switch is off. Removing UI."),$("#stream").addClass("center-block").removeClass("pull-left"),$("#twitch-chat").remove(),$("#twitch-clear").remove())}$(page_elem).append(footerHTML);var n=setInterval(function(){console.log("Looking for Settings Menu"),$(".settings-menu").length>0&&($(".settings-menu").append(settingsHTML),clearInterval(n),$("#refresh-timer-update").on("submit",function(e){e.preventDefault();var t=$("#refresh-timer-update").serializeArray()[0].value;return updateRefreshRate(t),!1}),$("#schedule-items-update").on("submit",function(e){e.preventDefault();var t=$("#schedule-items-update").serializeArray()[0].value;return console.log(t),sendUpdateCalendarItemsNumber(t),!1}),$(".fa.fa-refresh").click(function(){this.className="fa fa-refresh fa-spin",console.log("Refreshing..."),requestDataFromBackground();var e=this;setTimeout(function(){e.className="fa fa-refresh",console.log("Refresh complete.")},2e3)}),$(".fa.fa-cog").click(function(){this.className="fa fa-cog fa-spin";var e=this;setTimeout(function(){e.className="fa fa-cog"},2e3)}))},1e3);$(page_elem).css("margin-bottom","70px"),$("#stream").html('<iframe src="https://player.twitch.tv/?channel=gamesdonequick" width="100%" height="100%" frameborder="0" scrolling="no" allowFullscreen="true" class="center-block"></iframe>'),$("#stream").css("margin-top","24px"),$(".game-information").append(game_link_a),$(".game-information").append(runners_paragraph);var a=setInterval(function(){$("[name='quakenet-chat-switch']").length>0&&($("[name='quakenet-chat-switch']").bootstrapSwitch(),$("[name='twitch-chat-switch']").bootstrapSwitch(),$("[name='theater-mode']").bootstrapSwitch(),$('input[name="theater-mode"]').on("switchChange.bootstrapSwitch",function(t,n){$('input[name="quakenet-chat-switch"]').bootstrapSwitch("state")&&(e("remove"),$('input[name="quakenet-chat-switch"]').bootstrapSwitch("state",!1,!0)),$('input[name="theater-mode"]').bootstrapSwitch("state")?($("#stream").html(""),$("#battlescene").before(quakeTheatherMode),$("#footer").addClass("theater-footer").removeClass("standard-footer")):($("#theater-mode-div").remove(),$("#stream").html('<iframe src="https://player.twitch.tv/?channel=gamesdonequick" width="100%" height="100%" frameborder="0" scrolling="no" allowFullscreen="true" class="center-block"></iframe>'),$("#footer").addClass("standard-footer").removeClass("theater-footer"))}),$('input[name="quakenet-chat-switch"]').on("switchChange.bootstrapSwitch",function(n,a){console.log("Clicked QUAKENET Switch."),console.log(this),console.log("Twitch State:"),console.log($('input[name="twitch-chat-switch"]').bootstrapSwitch("state")),console.log("Quake State:"),console.log($('input[name="quakenet-chat-switch"]').bootstrapSwitch("state")),$('input[name="twitch-chat-switch"]').bootstrapSwitch("state")?(t("remove"),$('input[name="twitch-chat-switch"]').bootstrapSwitch("state",!1,!0),e($('input[name="quakenet-chat-switch"]').bootstrapSwitch("state")?"add":"remove")):(console.log(),e($('input[name="quakenet-chat-switch"]').bootstrapSwitch("state")?"add":"remove"))}),$('input[name="twitch-chat-switch"]').on("switchChange.bootstrapSwitch",function(n,a){console.log("Clicked Twitch Switch."),$('input[name="quakenet-chat-switch"]').bootstrapSwitch("state")?(e("remove"),$('input[name="quakenet-chat-switch"]').bootstrapSwitch("state",!1,!0),t($('input[name="twitch-chat-switch"]').bootstrapSwitch("state")?"add":"remove")):t($('input[name="twitch-chat-switch"]').bootstrapSwitch("state")?"add":"remove")}),clearInterval(a))},1e3)});var port=browser.runtime.connect({name:"gdq"});port.postMessage({message:"request"}),port.onMessage.addListener(function(e){"changed"==e.status?(console.log(e),console.log("The Current Game is: "+e.game),$()&&(updateUI(e),updateCalendarUI(e.calendar))):"unchanged"==e.status?console.log("Current game has not changed since last request"):"reload"==e.status&&(console.log("Reload has occurred"),console.log(e),console.log("The Current Game is: "+e.game),updateUI(e),updateCalendarUI(e.calendar))}),refreshTimer=setInterval(requestDataFromBackground,refreshRate);
//# sourceMappingURL=contentscript.js.map
